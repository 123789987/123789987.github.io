<!DOCTYPE html>
<html>
  <head>
    <title>install nginx php7 mysql server in ubuntu</title>
  </head>
  <body>
    <h1>install nginx php7 mysql server in ubuntu</h1>
    <p>获取root权限，进入/root目录</p>
    <code>
      sudo su<br />
      cd ~
    </code>
    <p>更新软件源</p>
    <code>
      apt-get update
    </code>
    <p>添加php软件源，并且安装php7.3 mysql nginx</p>
    <code>
      apt-add-repository ppa:ondrej/php<br />
      apt-get install mysql-server php7.3 php7.3-fpm php-mysql nginx -y
    </code>
    <h3>初始化数据库，并修改密码输入：</h3>
    <code>
      mysql
    </code>
    <p>进入数据库，再输入：（将引号中的password改成你想设置的密码）</p>
    <code>
      alter user root@localhost identified with mysql_native_password by 'password';
    </code>
    <p>退出</p>
    <code>
      quit
    </code>
    <p>测试一下，输入：</p>
    <code>
      mysql -uroot -p
    </code>
    <p>会出现输入密码的提示，输入刚才的密码，回车，输入下面的命令测试一下：</p>
    <code>
      show databases;
    </code>
    <p>无误后</p>
    <code>
      quit
    </code>
    <p>退出</p>
    <h3>进入目录，修改php配置文件php.ini</h3>
    <code>
      cd /etc/php/7.3/fpm<br />
      vim php.ini
    </code>
    <p>寻找取消下面语句的注释，去掉前面的分号</p>
    <code>
      cgi.fix_pathinfo=1<br />
      extension=curl<br />
      extension=fileinfo<br />
      extension=gd2<br />
      extension=mbstring<br />
      extension=mysqli<br />
      extension=pdo_mysql<br />
    </code>
    <p>进入网站根目录，写一个php文件</p>
    <code>
      cd /var/www/html<br />
      vim index.php
    </code>
    <p>输入以下内容</p>
    <code>
&lt;?php<br />
phpinfo();<br />
$sql = mysqli_connect('localhost', 'root', 'password');<br />
if(!$sql) echo "fail\n"; else echo "ok\n";<br />
?&gt;
    </code>
    <p>运行一下该文件（输入下面的命令），会出现phpinfo以及最后一行的ok，证明php成功连接mysql数据库，否则有错误</p>
    <code>
      php -f index.php
    </code>
    <h3>进入目录编辑nginx配置文件，让nginx生成网页时可以运行php代码</h3>
    <code>
      cd /etc/nginx/sites-available<br />
      vim default
    </code>
    <p>找到location ~ \.php$ 先取消掉注释把{}里的内容改成：</p>
    <code>
    location ~ \.php$ {<br />
            try_files $uri =404;<br />
            fastcgi_split_path_info ^(.+\.php)(/.+)$;<br />
            fastcgi_pass unix:/run/php/php7.3-fpm.sock;<br />
            fastcgi_index index.php;<br />
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;<br />
            include fastcgi_params;<br />
    }
    </code>
    <p>找到location ~ /\.ht 取消注释把{}里的内容改成：</p>
    <code>
    location ~ /\.ht {<br />
        deny all;<br />
    }
    </code>
    <h3>启动服务</h3>
    <code>
      cd ~<br />
      service php7.3-fpm start<br />
      service nginx start<br />
      service nginx restart<br />
    </code>
    <p>最后发现nginx要重启（restart）一下，否则php代码不能正常运行</p>
    <p>最后打开浏览器，访问服务器ip，会看到nginx欢迎交界面，说明nginx运行正常，访问(your ip)/index.php，会看到phpinfo，以及最后一行的ok，说明生成网页时可以运行php代码，并且php成功连接mysql数据库。</p>
  </body>
</html>
